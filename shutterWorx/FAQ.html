<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join ShutterWorx</title>
    <!-- Bootstrap CSS for styling -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="../css/main.css">

    <style>
        /* Styling for FAQ Container */
        .container { max-width: 800px; margin: auto; padding: 20px; }
        header h1 { font-size: 2.5em; color: #333; }
        
        /* Search Bar */
        .search-bar input {
            width: 100%; padding: 10px; font-size: 1em;
            border-radius: 5px; border: 1px solid #ddd;
        }
        
      /* FAQ Item Styles */
.faq-item h3 {
    cursor: pointer;
    padding: 10px;
    background: #f1f1f1;
    border-radius: 4px;
    transition: background-color 0.3s;
}
.faq-item h3:hover {
    background-color: #e2e2e2;
}



.faq-item .faq-answer {
    display: none;
    padding: 10px;
    background: #f9f9f9;
}

.faq-item.active .faq-answer {
    display: block;
}
.faq-item p {
    height: 0;
    overflow: hidden;
    transition: height 0.5s ease, padding 0.5s ease;
    padding: 0 10px;
}
.faq-item.active p {
    height: auto;  /* Auto height allows the content to be fully visible */
    padding: 10px;
}

.hide {
        opacity: 0;
    }
        
        /* Highlighted Text */
        .highlight { background-color: yellow; font-weight: bold; }
        
        /* Topics Area */
        .topic { background-color: #007bff; color: white; padding: 8px 12px; border-radius: 15px; margin: 5px; cursor: pointer; }
        .topic:hover { background-color: #0056b3; }
    
    
        .faq-icon {
    transition: transform 0.3s ease;  /* Adds smooth transition */
    float: right;
    font-size: 20px;
}
.faq-item.active .faq-icon {
    transform: rotate(45deg); /* Rotates icon when active */
}

#no-results-box {
    text-align: center;
    margin-top: 20px;
    font-size: 18px;
    color: red;
}

    
    
    </style>
</head>
<body>

    <!-- Header -->
    <header id="site-header">
        <h1 id="header-title">Join ShutterWorx</h1>
        <p id="header-subtitle">Your gateway to exclusive photography services and community!</p>
        <nav id="nav-menu">
            <ul>
                <li><a href="../shutterWorx/" aria-label="Home">Home</a></li>
                <li><a href="../shutterWorx/join" aria-label="Join Now">Join Now</a></li>
                <li><a href="../shutterWorx/FAQ" aria-label="FAQ">FAQ</a></li>
                <li><a href="../shutterWorx/contact" aria-label="Contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
       <!-- Header -->
       <div class="hero header text-center py-5" >
        <h1>Frequently Asked Questions</h1>
        <p>Find answers to the most common questions</p>
       </div>
        

     <!-- Search Bar -->
     <section class="search-bar text-center my-4">
        <div class="row justify-content-center">
            <div class="col-md-8 col-12">
                <input type="text" id="faq-search" placeholder="Search FAQs..." class="form-control">
            </div>
        </div>
    </section>
    

    <select id="faq-topic-filter" class="m-auto my-4">
        <option value="">All Topics</option>
        <option value="Account">Account</option>
        <option value="General">General</option>
        <option value="Subscription">Subscription</option>
        <option value="Support">Support</option>
    </select>

    <!--
    <button aria-label="Scroll to FAQs" onclick="scrollToFaq()">Go to FAQs</button>
-->

    <!-- Dynamic Topics Area -->
    <section class="topics-area text-center my-5">
        <h2>Popular Topics</h2>
        <div id="topics-container" class="d-flex flex-wrap justify-content-center">
            <!-- Topics will be dynamically inserted here -->
        </div>
    </section>

    <!-- FAQ Items -->
    <section id="faq-items" class="faq-items" aria-live="polite">
        <!-- FAQ items are dynamically loaded here -->
    </section>


    <div id="no-results" class="container py-4" style="display: none;">
        <!-- Message Section -->
        <div class="alert alert-info mb-4">
            <p class="mb-0">If you have any additional questions, feel free to browse the FAQs below for more information.</p>
        </div>
        
        <!-- FAQ Items Section -->
        <div id="ran-faq-items-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <!-- The random FAQ questions will be populated here -->
        </div>
    
        <!-- No Results Box -->
        <div id="no-results-box" class="alert alert-warning text-center mt-4" >
            No results found. Please refine your search and try again.

    
        <!-- Contact Us Link -->
        <div class="text-center mt-2">
            <small>
                Still have questions? 
                <a href="../shutterWorx/contact" class="text-primary">Contact us</a> for further assistance.
            </small>
        </div>
        </div>
    </div>
    


        <div class="mt-5 text-center">
            <p><small>Still have questions? <a href="../shutterWorx/contact" class="text-primary">Contact us</a> for more information.</small></p>
        </div>
    </main>

    <!-- Footer -->
    <footer id="site-footer">
        <div class="social-icons">
            <!-- Social media links dynamically added here -->
        </div>
        <footer-body>
            <p>&copy; 2024 <a href="../shutterWorx/" style="color: #fff;">ShutterWorx</a>/ TechNoob All Rights Reserved.</p>
            <p><small><a href="privacy" style="color: #fff;">Privacy Policy</a> | <a href="terms" style="color: #fff;">Terms of Service</a></small></p>
        </footer-body>
    </footer>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>



<script  type="module" src="../js/main.js"></script>
<script  type="module" src="../js/firebaseConfig.js"></script>


<!-- Include your firebaseConfig.js as a module -->
<script type="module">
    import {  db, doc,getDoc, query, updateDoc,
    setDoc,     signInWithPopup,
    GoogleAuthProvider,
    FacebookAuthProvider,
    OAuthProvider,arrayUnion ,
    signOut, addDoc , increment,
    onAuthStateChanged,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    where, getDocs, storage, collection, auth, analytics  } from '../js/firebaseConfig.js';
/*
    const faqsRef = collection(db, "faqs");
const faqSnapshot = await getDocs(faqsRef);
const faqs = faqSnapshot.docs.map(doc => doc.data());
displayFaqs(faqs);
*/


    document.addEventListener("DOMContentLoaded", function () {


        const faqsPerPage = 10; // Initial number of FAQs to display

const topicsContainer = document.getElementById("topics-container");
        let faqItemsContainer = document.getElementById("faq-items");

        const topicFilter = document.getElementById("faq-topic-filter");
      // let  faqItemsContainer = document.getElementById("faq-items-container");

let displayedFaqs = faqsPerPage;

let faqs = []; 
let  filteredFaqs = [];

    // Fetch FAQ data from the JSON file
    fetch('faqs.json')
        .then(response => response.json())
        .then(FAQs => {
            faqs = FAQs
            displayFaqs(faqs);

            // Filter FAQs when a topic is selected
            topicFilter.addEventListener("change", (e) => {
                const selectedTopic = e.target.value;
                 filteredFaqs = selectedTopic ? faqs.filter(faq => faq.topic === selectedTopic) : faqs;
                displayFaqs(filteredFaqs);
                console.log("filteredFaqs topicFilter   ",filteredFaqs);
            });

        })
        .catch(error => {
    console.error("Error fetching FAQ data:", error);
    faqItemsContainer.innerHTML = "<p>Sorry, we're unable to load the FAQs at the moment.</p>";
});


const loadMoreBtn = document.createElement("button");
loadMoreBtn.textContent = "Load More";
loadMoreBtn.className = "load-more";
loadMoreBtn.style.display = "none";
faqItemsContainer.after(loadMoreBtn);

   // Load more FAQs when the button is clicked
   loadMoreBtn.addEventListener("click", () => {
displayedFaqs += faqsPerPage;
displayFaqs(faqs, displayedFaqs);

});


        // Function to display FAQs with optional limit
// Function to display FAQs with optional limit
function displayFaqs(faqData, limit = displayedFaqs) {
    faqItemsContainer.innerHTML = ""; // Clear current FAQs
    if (Array.isArray(faqData)) {
        console.log("faqData is an array");
    }else{
        console.log("NO Arrays");
      //  faqData = faqs;

        return;
    }
    if (Array.isArray(faqData)) {

    displayRandomFaqs(faqData)
    console.log("faqData    ",faqData);
    }

    // Display FAQs based on limit
    let faqCount = 0;
    faqData.slice(0, limit).forEach(faq => {
        const faqItem = document.createElement("div");
        faqItem.className = "faq-item";
        faqCount += 1;

        const answer = document.createElement("p");
        answer.textContent = faq.answer;
        answer.setAttribute("data-loaded", "false");
        answer.id = `answer-${faqCount}`;
        answer.setAttribute("aria-hidden", "true");
        answer.style.display = "none";  // Start hidden

        const question = document.createElement("h3");
        question.innerHTML = faq.question + `<span class="faq-icon">+</span>`;
        question.setAttribute("aria-expanded", "false");
        question.setAttribute("aria-controls", `answer-${faqCount}`);

        question.addEventListener("click", () => {
    const isLoaded = answer.getAttribute("data-loaded") === "true";
    if (!isLoaded) {
        answer.textContent = faq.answer;
        answer.setAttribute("data-loaded", "true");
    }
    const isExpanded = faqItem.classList.toggle("active");
    question.setAttribute("aria-expanded", isExpanded.toString());
    document.getElementById(`answer-${faqCount}`).setAttribute("aria-hidden", (!isExpanded).toString());
    answer.style.display = isExpanded ? "block" : "none"; // Toggle visibility
    // Toggle the icon between plus and minus
    const icon = faqItem.querySelector('.faq-icon');
    icon.innerHTML = isExpanded ? `<span class="faq-icon">-</span>` : `<span class="faq-icon">+</span>`;  // Change the icon text


});
faqItem.classList.add( "fade-in"); // Initially hidden for transition


        faqItem.appendChild(question);
        faqItem.appendChild(answer);
        faqItemsContainer.appendChild(faqItem);
        setTimeout(() => {
        faqItem.classList.remove("fade-in");
     //   faqItem.classList.add("fade-in");
    }, 500);
    });

    loadMoreBtn.style.display = faqs.length > displayedFaqs ? "block" : "none";

    // Show or hide the Load More button
   // loadMoreBtn.style.display = faqData.length > limit ? "block" : "none";
}

// Function to highlight matching text
function highlightText(text, query) {
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<span class="highlight">$1</span>');
}




//// Search and Highlight FAQ Items
document.getElementById("faq-search").addEventListener("input", function () {
    const searchQuery = this.value.toLowerCase();
    let hasResults = false;

    const faqItems = document.querySelectorAll(".faq-item");
 console.log("faqItems    ",faqItems);

    faqItemsContainer.innerHTML = ""; // Clear the container before displaying results
    console.log("filteredFaqs main search    ",filteredFaqs);

    filteredFaqs.forEach((faq, index) => {
        const question = faq.question.toLowerCase();
        const answer = faq.answer.toLowerCase();

        if (question.includes(searchQuery) || answer.includes(searchQuery)) {
            hasResults = true;
            const faqItem = document.createElement("div");
            faqItem.className = "faq-item";

            // Highlight matched text
            const highlightedQuestion = faq.question.replace(
                new RegExp(searchQuery, "gi"),
                match => `<span class="highlight">${match}</span>`
            );

            const questionElement = document.createElement("h3");
            questionElement.innerHTML = highlightedQuestion + `<span class="faq-icon">+</span>`;
            questionElement.setAttribute("aria-expanded", "false");

            const answerElement = document.createElement("p");
            answerElement.innerHTML = faq.answer.replace(
                new RegExp(searchQuery, "gi"),
                match => `<span class="highlight">${match}</span>`
            );
            answerElement.style.display = "none";

            faqItem.appendChild(questionElement);
            faqItem.appendChild(answerElement);
            faqItemsContainer.appendChild(faqItem);

            questionElement.addEventListener("click", () => {
                const isExpanded = questionElement.getAttribute("aria-expanded") === "true";
                answerElement.style.display = isExpanded ? "none" : "block";
                questionElement.setAttribute("aria-expanded", !isExpanded);
            });
        }
    });

    // Show or hide the 'No Results' message based on search results
    document.getElementById("no-results").style.display = hasResults ? "none" : "block";
});

    
/*



  // Toggle expansion state and update icon
    const isExpanded = item.classList.toggle("active");
    questionEl.innerHTML += isExpanded ? `<span class="faq-icon">-</span>` : `<span class="faq-icon">+</span>`;
    faqItem.classList.add( "fade-in"); // Initially hidden for transition

    faqItem.appendChild(question);
                faqItem.appendChild(answer);

                faqItemsContainer.appendChild(faqItem);
                faqItem.classList.remove( "fade-in"); // Initially hidden for transition

                setTimeout(() => {
        }, 300);



    filteredFaqs.forEach(faq => {
                const faqItem = document.createElement("div");
                faqItem.className = "faq-item mb-3 p-3 border rounded";

                const question = document.createElement("h3");
                question.innerHTML = highlightText(faq.question, query); // Highlight in question
               
                const isExpanded = faqItem.classList.toggle("active");
                question.innerHTML += isExpanded ? `<span class="faq-icon">-</span>` : `<span class="faq-icon">+</span>`;  // Change the icon text
           
                const answer = document.createElement("p");
                answer.innerHTML = highlightText(faq.answer, query); // Highlight in answer

                faqItem.appendChild(question);
                faqItem.appendChild(answer);

                faqItemsContainer.appendChild(faqItem);
            });
*/


    let randomFaqS = [];
// Function to display random FAQs (5 random questions)
function displayRandomFaqs(randomFaqs) {
    while (randomFaqs.length < 10) {
        console.log("randomFaqs.length    ",randomFaqs.length);

        const randomIndex = Math.floor(Math.random() * randomFaqs.length);
        if (!randomFaqs.includes(faqs[randomIndex])) {
            randomFaqS.push(faqs[randomIndex]);

            console.log("faqs[randomIndex]    ",faqs[randomIndex]);
            console.log("randomFaqS    ",randomFaqS);
        }
   
}
    const ran_faqItemsContainer = document.getElementById("ran-faq-items-container");
    ran_faqItemsContainer.innerHTML = ''; // Clear existing content
console.log("randomFaqS outside    ",randomFaqS);

    randomFaqS.forEach(faq => {
        console.log("randomFaqS faq    ",faq);

        const faqItem = document.createElement("div");
        faqItem.classList.add("faq-item");
        
        const question = document.createElement("div");
        question.innerHTML = `<li>`+faq.question+`</li>`;

        faqItem.appendChild(question);
        ran_faqItemsContainer.appendChild(faqItem);

        // Add a click listener to search for the clicked question
        question.addEventListener("click", function () {
            const faqSearch = document.getElementById("faq-search");

            faqSearch.value = faq.question;
            faqSearch.dispatchEvent(new Event("input"));  // or "change" if it applies

        });
    });




}



function scrollToFaq() {
    document.getElementById("faq-items").scrollIntoView({ behavior: 'smooth' });
}

//const topics = ["Account", "General", "Subscription", "Support"]; // This can be dynamic
if (Array.isArray(faqs)) {

            // Create a set of unique topics
    const topics = [...new Set(faqs.map(faq => faq.topic))];
    
    // Populate topics dynamically
topics.forEach(topic => {
    const topicElement = document.createElement("div");
    topicElement.classList.add("topic");
    topicElement.textContent = topic;
    topicElement.addEventListener("click", () => {
        const filteredFaqs = faqs.filter(faq => faq.topic === topic);
        displayFaqs(filteredFaqs);
    });
    topicsContainer.appendChild(topicElement);
});

}
    // Filter by topic
    function filterByTopic(topic) {
         filteredFaqs = faqs.filter(faq => faq.topic === topic);
        displayFaqs(filteredFaqs);
    }

    // Initial display of all FAQs
    displayFaqs(faqs);
});

/*
const faqItems = document.querySelectorAll(".faq-item");

faqItems.forEach(faqItem => {
    const question = faqItem.querySelector(".faq-question");
    const answer = faqItem.querySelector(".faq-answer");

    question.innerHTML = question.innerHTML  = isExpanded ? `<span class="faq-icon">-</span>` : `<span class="faq-icon">+</span>`;  // Change the icon text

    // Apply the highlighting to both question and answer
   question.innerHTML = highlightText(question.innerHTML, query);
    answer.innerHTML = highlightText(answer.innerHTML, query);

    question.addEventListener("click", () => {
        const isExpanded = faqItem.classList.toggle("active");
        const icon = faqItem.querySelector(".faq-icon");

        icon.innerHTML = isExpanded ? `<span class="faq-icon">-</span>` : `<span class="faq-icon">+</span>`;  // Change the icon text
        answer.style.display = isExpanded ? "block" : "none"; // Show or hide answer

    });
});

 */

     




        let viewStartTime;

// Function to set the last internal page in sessionStorage before navigating
function setInternalPageSource() {
    sessionStorage.setItem('lastInternalPage', window.location.href);
}

// Function to start tracking the view time when the page loads
function startViewTimer() {
    viewStartTime = Date.now();
    //console.log("viewStartTime   ",viewStartTime);

}



    // Determine the source
    const externalSource = document.referrer && !document.referrer.includes(window.location.origin)
        ? document.referrer
        : null;
    const internalSource = sessionStorage.getItem('lastInternalPage');
    const viewSource = externalSource || internalSource || 'Direct Visit';



    let ipAddress;
let locationData;

document.addEventListener("DOMContentLoaded", async () => {
    try {
        const { ip, location } = await window.userLocationService.getUserIPAndLocation();

        ipAddress = ip;
        locationData = location;
    } catch (error) {
        console.error("Error fetching user IP and location:", error);
    }
});




    

 function updateViewData() {
    // Calculate view duration in seconds
    const viewEndTime = Date.now();
    const durationOfView = (viewEndTime - viewStartTime) / 1000; // Convert ms to seconds

    // Validate IP address before proceeding
    if (!ipAddress) {
        console.error("Missing IP address. View data not recorded.");
        return;
    }


    // Prepare the data to be updated
    const viewData = {
        FAQViewedBy: {
            viewDate: new Date().toISOString(),
            viewMethod: navigator.userAgentData?.mobile ? "mobile" : "desktop",
            durationOfView: (Date.now() - viewStartTime) / 1000,
            viewSource: viewSource
        },
        ipAddress: ipAddress,
        city: locationData.city,
        zipCode: locationData.zip,
        state: locationData.state,
        country: locationData.country,
        contactViews: increment(1)
    };

    console.log("viewData   ",viewData);

    // Update or create the job view data in the Jobs collection
    setDoc(doc(db, 'guest-ShutterWorx', ipAddress), viewData, { merge: true });
      //  console.log("Job view data updated successfully.");
 
}


// Event listener to set last internal page before navigating away
window.addEventListener('beforeunload', setInternalPageSource);

// Event listener to start timing the view when the page loads
window.addEventListener('load', startViewTimer);

// Event listener to record data when the page is unloaded
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'hidden') {
        updateViewData();
    }
});

     
  
/*
setTimeout(() => {
    updateViewData();
}, 5000); // Close modal after 5 seconds
*/

</script>

</body>
</html>
