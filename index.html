<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RAW Photography - Capturing moments through stunning photography. Explore our gallery, book a session, and see what our clients say.">
    <meta name="keywords" content="photography, RAW photography, portrait, events, book a session">
    <meta name="author" content="RAW Photography">
    
    <!-- Open Graph Meta Tags for Social Media Sharing -->
    <meta property="og:title" content="RAW Photography">
    <meta property="og:description" content="Capturing Moments, One Click at a Time">
    <meta property="og:image" content="path/to/default-image.jpg"> <!-- Update with a real image URL -->
    <meta property="og:url" content="https://www.rawphotography.com"> <!-- Update with your actual URL -->
    
    <title>RAW Photography</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" href="path/to/favicon.ico" type="image/x-icon"> <!-- Add a favicon for branding -->

    <style>


        /* Gallery Styles */
        #gallery {
            padding: 20px;
            text-align: center;
        }

        #gallery h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        #gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        #gallery-grid img {
            width: 100%;
            height: auto;
            cursor: pointer;
            border-radius: 8px;
            transition: transform 0.2s;
        }

        #gallery-grid img:hover {
            transform: scale(1.05);
        }

        /* CTA Button Styles */
        #cta-buttons {
            margin: 20px 0;
        }

        #cta-buttons button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #333;
            color: #fff;
            transition: background-color 0.3s;
        }

        #cta-buttons button:hover {
            background-color: #555;
        }

        /* Testimonials Section Styles */
        #testimonials {
            background-color: #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        #testimonial-list {
            max-width: 600px;
            margin: auto;
            font-style: italic;
        }

        #testimonial-list p {
            margin: 15px 0;
            border-left: 4px solid #333;
            padding-left: 10px;
        }

        /* Contact Section Styles */
        #contact {
            padding: 20px;
            text-align: center;
        }

        #contact h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        #contact form {
            display: flex;
            flex-direction: column;
            max-width: 400px;
            margin: auto;
        }

        #contact label {
            margin-top: 10px;
        }

        #contact input, #contact textarea {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #contact button {
            margin-top: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #contact button:hover {
            background-color: #555;
        }

        /* Lightbox Styles */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
        }




    </style>
</head>
<body>
    <!-- Header -->
    <header id="site-header">
        <h1>Welcome to RAW Photography</h1>
        <p>Capturing Moments, One Click at a Time</p>
        <nav>
            <ul>
                <li><a href="index">Home</a></li>
                <li><a href="events">Events</a></li>
                <li><a href="portfolio">Portfolio</a></li>
                <li><a href="contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Gallery Section -->
    <section id="gallery">
        <h2>Gallery</h2>
        <div id="gallery-grid">
            <!-- Dynamically loaded images will be inserted here -->
        </div>
        <div id="cta-buttons">
            <button id="book-session-btn" onclick="location.href='contact'">Book a Session</button>
            <button id="view-portfolio-btn" onclick="location.href='events'">View Portfolio</button>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials">
        <h2 id="testimonials-title">What Our Clients Say</h2>
        <div id="testimonial-list">
            <!-- Testimonials will be inserted here -->
        </div>
    </section>

    <!-- Contact Form Section -->
    <section id="contact">
        <h2 id="contact-title">Contact Us</h2>
        <form id="contactForm">
            <label for="name">Name</label>
            <input type="text" id="name" required>

            <label for="email">Email</label>
            <input type="email" id="email" >

            <label for="phone">Email</label>
            <input type="tel" id="phone" required>

            <label for="message">Message</label>
            <textarea id="message" required></textarea>

            <div id="formResponse"></div>

            <button id="send-message-btn" type="submit">Send Message</button>
        </form>
    </section>

    <!-- Lightbox for images -->
    <div id="lightbox" class="lightbox">
        <span class="close" onclick="closeLightbox()">&times;</span>
        <img class="lightbox-content" id="lightbox-image">
    </div>

<!-- Footer -->
<footer id="site-footer">
    <div class="social-icons">
        <!-- Social media links dynamically added here -->
    </div>
    <footer-body>
        <p>&copy; 2024 RAW Photography. All Rights Reserved.</p>
        <p><small><a href="privacy" style="color: #fff;">Privacy Policy</a> | <a href="terms" style="color: #fff;">Terms of Service</a></small></p>
        <p><a href="admin-login" style="color: #fff;">Admin Login</a></p>
    </footer-body>
</footer>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">



    <script type="module">
        import {  db, doc,getDoc, query, updateDoc,
    setDoc,     signInWithPopup,
    GoogleAuthProvider,
    FacebookAuthProvider,
    OAuthProvider, arrayUnion ,
    signOut, addDoc ,
    onAuthStateChanged, increment,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    where, getDocs, storage, collection, auth, analytics  } from './js/firebaseConfig.js';

        async function loadSettings() {
    const docRef = doc(db, "settings", "home_Page"); // Reference to the Home_Page document
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
        const data = docSnap.data();

        // Update header section
        document.getElementById("header-title").innerText = data.headerTitle || "Default Title";
        document.getElementById("header-subtitle").innerText = data.headerSubtitle || "Default Subtitle";
               
        // Update navigation menu
        const navMenu = document.getElementById("navigation-menu");
        navMenu.innerHTML = ''; // Clear existing menu
        data.navigationItems.forEach(item => {
            const li = document.createElement("li");
            li.innerText = item; // Add each navigation item
            navMenu.appendChild(li);
        });
       
       
        // Update gallery section
        document.getElementById("gallery-title").innerText = data.galleryTitle || "Gallery";
        

        // Update testimonials section
        document.getElementById("testimonials-title").innerText = data.testimonialsTitle || "Testimonials";
        
        const testimonialList = document.getElementById("testimonial-list");
        testimonialList.innerHTML = ''; // Clear existing testimonials
        data.testimonials.forEach(testimonial => {
            const div = document.createElement("div");
            div.className = "testimonial-item";
            div.innerText = testimonial; // Add testimonial text
            testimonialList.appendChild(div);
        });

        // Update contact section
        document.getElementById("contact-title").innerText = data.contactTitle || "Contact Us";
    } else {
        console.log("No such document!");
    }
}




        // Load Gallery
        async function loadGallery() {
            const galleryGrid = document.getElementById("gallery-grid");
            try {
                const q = query(collection(db, "images"), where("isPublic", "==", true));
                const snapshot = await getDocs(q);
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const imgElement = document.createElement("img");
                    imgElement.src = data.url; // Adjust based on your structure
                    imgElement.alt = data.description || "Gallery Image";
                    imgElement.onclick = function () { openLightbox(imgElement.src); };
                    galleryGrid.appendChild(imgElement);
                });
            } catch (error) {
                console.error("Error loading gallery:", error);
            }
        }

        


    // Initialize Gallery and Testimonials
    async function init() {
        await loadSettings();
        await loadGallery();
    }

    

let viewStartTime;

// Function to set the last internal page in sessionStorage before navigating
function setInternalPageSource() {
    sessionStorage.setItem('lastInternalPage', window.location.href);
}

// Function to start tracking the view time when the page loads
function startViewTimer() {
    viewStartTime = Date.now();
}



    // Determine the source
    const externalSource = document.referrer && !document.referrer.includes(window.location.origin)
        ? document.referrer
        : null;
    const internalSource = sessionStorage.getItem('lastInternalPage');
    const viewSource = externalSource || internalSource || 'Direct Visit';



    let ipAddress;
let locationData;

(async () => {
    const { ip, location } = await window.userLocationService.getUserIPAndLocation();
    
    ipAddress = ip;
    locationData = location;


})();



        // Handle form submission
// Assuming you have initialized Firestore previously
document.getElementById("contactForm").addEventListener("submit", async function (event) {
    event.preventDefault(); // Prevent the default form submission behavior

    window.showLoadingSpinner(false); // Show spinner during processing
    document.getElementById("send-message-btn").disabled = true; // Disable button
document.getElementById("send-message-btn").innerHTML = "Sending..."; // Show loading state

    // Get form values and sanitize them
    const name = sanitizeInput(document.getElementById('name').value);
    const email = sanitizeInput(document.getElementById('email').value);
    const phone = sanitizeInput(document.getElementById('phone').value);
    const message = sanitizeInput(document.getElementById('message').value);

    // Input validation
    if (!isSafeInput(name) || !isSafeInput(email) || !isSafeInput(phone) || !isSafeInput(message)) {
        const formResponse = document.getElementById("formResponse");
        formResponse.textContent = 'Invalid characters detected in form. Please remove any special characters.';
        formResponse.style.color = 'red';
        window.hideLoadingSpinner(); // Hide spinner on validation error
        return;
    }

    // Prepare data for Firestore
    const formData = {
        name,
        email,
        phone,
        message,
        externalSource: externalSource,
        internalSource: internalSource,
        ipAddress: ipAddress,                       // ID of the user or 'guest'
            city: locationData.city,
    zipCode: location.postal,
    state: locationData.region,
    country: locationData.country_name,
        contact_form: "Home Page",
        timestamp: new Date()  // Optional: Add timestamp
    };

    try {
        // Specify the 'messages' collection in the Firestore database
        const messagesCollectionRef = collection(db, 'messages');
        
        // Add the document to the 'messages' collection
        await addDoc(messagesCollectionRef, formData);
        
        // Show success message
        showToast('Message sent successfully!', 'success');
    } catch (error) {
        console.error("Error sending message: ", error);
        const formResponse = document.getElementById("formResponse");
        formResponse.textContent = 'There was an error sending your message. Please try again.';
        formResponse.style.color = 'red';
    } finally {
        window.hideLoadingSpinner(); // Ensure the spinner is hidden after processing
        document.getElementById("send-message-btn").innerHTML = "Sent"; // Show loading state

        // Clear the form
        document.getElementById("contactForm").reset();

        // Clear any previous response messages
        const formResponse = document.getElementById("formResponse");
        formResponse.innerHTML = ""; 
    }
});

    // Run initialization on window load
    window.onload = init;

    
    async function updateViewData() {
    // Calculate view duration in seconds
    const viewEndTime = Date.now();
    const durationOfView = (viewEndTime - viewStartTime) / 1000; // Convert ms to seconds

    // Validate IP address before proceeding
    if (!ipAddress) {
        console.error("Missing IP address. View data not recorded.");
        return;
    }



    // Prepare the view data to be updated
    const viewData = {
        homeViewedBy: arrayUnion({
            ipAddress: ipAddress,                       // ID of the user or 'guest'
            city: locationData.city,
    zipCode: location.postal,
    state: locationData.region,
    country: locationData.country_name,
                viewDate: new Date().toISOString(),
            viewMethod: navigator.userAgentData?.mobile ? "mobile" : "desktop", // Detects desktop or mobile view
            durationOfView: durationOfView || null,    // Optional: estimated duration of view in seconds
            viewSource: viewSource                      // Tracks the source of the view
        }),
        homeViews: increment(1) // Increment homeViews by 1
    };
    console.log("viewData   ",viewData);

    // Update or create the job view data in the Jobs collection
    try {
        await setDoc(doc(db, 'guest', ipAddress), viewData, { merge: true }); // Use setDoc with merge option
        console.log("Home view data updated successfully.");
    } catch (error) {
        console.error("Error updating home view data:", error);
    }
}


// Event listener to set last internal page before navigating away
window.addEventListener('beforeunload', setInternalPageSource);

// Event listener to start timing the view when the page loads
window.addEventListener('load', startViewTimer);

// Event listener to record data when the page is unloaded
window.addEventListener('beforeunload', updateViewData);





</script>
    <script  type="module" src="./js/main.js"></script>
</body>
</html>
