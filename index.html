<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAW Photography</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        #gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        img {
            width: 100%;
            height: auto;
            cursor: pointer;
        }
        #cta-buttons {
            text-align: center;
            margin: 20px 0;
        }
        #cta-buttons button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .lightbox {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header id="site-header">
        <h1>Welcome to RAW Photography</h1>
        <p>Capturing Moments, One Click at a Time</p>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="events.html">Events</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Gallery Section -->
    <section id="gallery">
        <h2>Gallery</h2>
        <div id="gallery-grid">
            <!-- Dynamically loaded images will be inserted here -->
        </div>
        <div id="cta-buttons">
            <button onclick="location.href='book-session.html'">Book a Session</button>
            <button onclick="location.href='events.html'">View Portfolio</button>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials">
        <h2>What Our Clients Say</h2>
        <div id="testimonial-list">
            <!-- Testimonials will be inserted here -->
        </div>
    </section>

    <!-- Contact Form Section -->
    <section id="contact">
        <h2>Contact Us</h2>
        <form id="contactForm">
            <label for="name">Name</label>
            <input type="text" id="name" required>

            <label for="email">Email</label>
            <input type="email" id="email" required>

            <label for="message">Message</label>
            <textarea id="message" required></textarea>

            <button type="submit">Send Message</button>
        </form>
    </section>

    <!-- Footer -->
    <footer id="site-footer">
        <p>&copy; 2024 RAW Photography. All Rights Reserved.</p>
        <p><a href="admin-login.html">Admin Login</a></p>
    </footer>
    

    <!-- Lightbox for images -->
    <div id="lightbox" class="lightbox">
        <span class="close" onclick="closeLightbox()">&times;</span>
        <img class="lightbox-content" id="lightbox-image">
    </div>

    <!-- Include your firebaseConfig.js as a module -->
    <script type="module">
        import { db, storage } from './js/firebaseConfig.js';
        import { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore.js'; // Import necessary Firestore functions

        async function loadGallery() {
            const galleryGrid = document.getElementById("gallery-grid");
            try {
                const q = query(collection(db, "images"), where("isPublic", "==", true)); // Use collection and query
                const snapshot = await getDocs(q);
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const imgElement = document.createElement("img");
                    imgElement.src = data.watermarkUrl;
                    imgElement.alt = data.title;
                    imgElement.classList.add("gallery-item");
                    imgElement.setAttribute("loading", "lazy");
                    imgElement.onclick = () => openLightbox(data.watermarkUrl);
                    galleryGrid.appendChild(imgElement);
                });
            } catch (error) {
                console.error("Error loading gallery:", error);
            }
        }

        // Open lightbox
        function openLightbox(src) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            lightboxImage.src = src;
            lightbox.style.display = "block";
        }

        // Close lightbox
        function closeLightbox() {
            document.getElementById('lightbox').style.display = "none";
        }

        // Load testimonials
        async function loadTestimonials() {
            const testimonialList = document.getElementById("testimonial-list");
            try {
                const snapshot = await getDocs(collection(db, "testimonials")); // Use collection and getDocs
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const testimonialElement = document.createElement("p");
                    testimonialElement.textContent = `"${data.quote}" - ${data.author}`;
                    testimonialList.appendChild(testimonialElement);
                });
            } catch (error) {
                console.error("Error loading testimonials:", error);
            }
        }

        // Contact form submission
        document.getElementById("contactForm").addEventListener("submit", async (event) => {
            event.preventDefault();
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const message = document.getElementById("message").value;

            try {
                await db.collection("appointments").add({
                    name: name,
                    email: email,
                    message: message,
                    dateRequested: new Date(),
                    status: "pending"
                });
                showToast("Message sent successfully!");
                document.getElementById("contactForm").reset();
            } catch (error) {
                console.error("Error sending message:", error);
                showToast("There was an error. Please try again.");
            }
        });

        loadGallery();
        loadTestimonials();
    </script>
    <script src="js/lightbox.js"></script> <!-- Include your lightbox script -->
</body>
</html>
